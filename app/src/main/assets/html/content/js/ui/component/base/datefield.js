/*!
 * datefield component
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(e,t,n){"use strict";function a(){return s?s:(e(n.body).append('<div id="'+p+'_float" class="c_float'+(c?" c_float-phone-auto":"")+'" style="width:20em;"><div  id="'+p+'_float_bg" class="bg"></div><div  id="'+p+'_float_content" class="content"></div></div>'),s=e.Calendar.append(p+"_float_content",{name:p,className:"c_calendar"+(c?"":" c_calendar-s")}),e("#"+p).select(function(n){d&&t[d]&&t[d]instanceof u&&!0!==t[d].useTime&&!0===t[d].dropDown&&(t[d].val(this.val()),e.event.trigger("afterAction",null,t[d].el),i())}),e("#"+p).clear(function(n){d&&t[d]&&t[d]instanceof u&&!0===t[d].dropDown&&(t[d].val(""),e.event.trigger("afterAction",null,t[d].el)),i()}),e("#"+p).ok(function(n){if(d&&t[d]&&t[d]instanceof u&&!0===t[d].useTime&&!0===t[d].dropDown)return t[d].val(this.val()),e.event.trigger("afterAction",null,t[d].el),i(),!1}),e("#"+p+"_float_bg").bind(f,function(){i()}),s)}function i(){if(d){var t=n.getElementById(p+"_float");if(null!=t&&1==t.nodeType){var a=t.className?t.className:"";(" "+a+" ").indexOf(" c_float-show ")>-1&&(t.className=e.trim((" "+a+" ").replace(/ c_float-show /gi," ")))}t=null,d=null}}if(e&&"undefined"==typeof e.DateField){var o=(Array.prototype.push,Array.prototype.splice,n.createElement("input")),l="oninput"in o;o=null;var s,d,r="undefined"!=typeof e.hasTouch?e.hasTouch:"ontouchstart"in t,f=r?"touchstart":"mousedown",c=e.os.phone||!0===e.ratioPhone,p="_Wade_DropDownCalendar",u=function(t,a){var i=this;i.el=t&&1==t.nodeType?t:n.getElementById(t),i.el&&i.el.nodeType&&(i.id=e.attr(i.el,"id"))&&(a&&e.isObject(a)&&e.extend(i,a),e.attr(i.el,"x-wade-uicomponent")||e.attr(i.el,"x-wade-uicomponent","datefield"),i._init(),i.constructor.call(i))};u.prototype=e.extend(new e.UIComponent,{val:function(e){var t=this;return void 0==e?t.el.value:void(t.value=t.el.value=e)},refresh:function(){var t=this;t.spanEl||(t.spanEl=e(t.el).parent("span.e_mix:first")[0]);var a=t.spanEl.getBoundingClientRect();t.spanLeft=a.left,t.spanTop=a.top,t.spanHeight=t.spanEl.offsetHeight,t.spanWidth=t.spanEl.offsetWidth;var i=t.spanTop,o=(t.spanLeft,n.body),l=o.offsetHeight-t.spanHeight-i;e.isNumber(o.scrollTop)&&(t.spanTop+=o.scrollTop-2),e.isNumber(o.scrollLeft)&&(t.spanLeft+=o.scrollLeft),t.dir=l>=i?"down":"up";var s="down"==t.dir?l:i,d=0,r=0,f=n.getElementById(p+"_float"),c=f.className?f.className:"";(" "+c+" ").indexOf(" c_float-show ")<0?(f.style.left="-99999px",f.style.top="-99999px",f.style.display="block",d=f.offsetWidth,r=f.offsetHeight,f.style.display=""):(d=f.offsetWidth,r=f.offsetHeight);var u=Math.min(s,r);f.style.left=t.spanLeft+t.spanWidth-d+"px",f.style.top=("down"==t.dir?t.spanTop+t.spanHeight:t.spanTop-u)+"px"},getDisabled:function(){var e=this;return e.disabled},setDisabled:function(t){var n=this;n.disabled=!!t;var a=n.el.className?n.el.className:"";n.disabled?((" "+a+" ").indexOf(" e_dis ")<0&&(n.el.className=e.trim(a+" e_dis")),n.el.disabled=!0):(a=e.trim((" "+a+" ").replace(/ e_dis /gi," ")),n.el.className=a,n.el.disabled=!1)},destroy:function(){var e=this;e.spanEl=null,e.icoEl=null,e.el=null},_init:function(){var t=this;if(t.spanEl=e(t.el).parent("span.e_mix:first")[0],t.icoEl=e(t.el).next("span.e_ico-date:first")[0],t.icoEl&&(t.icoEl.style.display=t.dropDown?"":"none"),(c||e.os.pad)&&e.attr(t.el,"readonly",!0),l?e(t.el).bind("input",function(e){this.value=(""+this.value).replace(/[^0-9-\/\s:]+/gi,"")}):e(t.el).keydown(function(e){return!(e.shiftKey||e.altKey||e.ctrlKey)&&(e.keyCode>47&&e.keyCode<58||e.keyCode>95&&e.keyCode<106||8==e.keyCode||46==e.keyCode||189==e.keyCode||191==e.keyCode)}),!0===t.dropDown){a();var i=function(a){if(!t.disabled&&!0===t.dropDown){a.originalEvent&&(a=a.originalEvent),s&&(e.extend(s,{now:t.now,format:t.format,value:t.value,useTime:t.useTime}),s.reset()),t.refresh();var i=n.getElementById(p+"_float"),o=i.className?i.className:"";(" "+o+" ").indexOf(" c_float-show ")<0&&(i.className=e.trim(o+" c_float-show")),d=t.id}};e(t.el).bind("tap",i),e(t.icoEl).bind("tap",i)}}}),e(function(){e(n.body).bind(f,function(t){if(t&&t.target){var a=t.target;if(a&&a.nodeType&&s){for(var o=0,l=!1;a&&a.nodeType&&a!=n.body&&o<50;){var r=e.attr(a,"id");if(r&&e.isString(r)&&(0==r.indexOf(d)||0==r.indexOf(p))){l=!0;break}a=a.parentNode,o++}l||i()}}}),e(t).bind("onorientationchange"in t?"orientationchange":"resize",function(){i()}),r||e(n.body).bind("mousewheel",function(e){i()})}),t.DateField=e.DateField=u}}(window.Wade,window,document);