/*!
 * navbar component
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(t,e,n){"use strict";if(t&&"undefined"==typeof t.NavBar){var i=Array.prototype.push,a=Array.prototype.splice,r="undefined"!=typeof t.hasTouch?t.hasTouch:"ontouchstart"in e,o=r?"touchstart":"mousedown",d=null,l={},s=function(e,i){var a=this;a.el=e&&1==e.nodeType?e:n.getElementById(e),a.el&&a.el.nodeType&&(a.id=t.attr(a.el,"id"))&&(i&&t.isObject(i)&&t.extend(a,i),t.attr(a.el,"x-wade-uicomponent")||t.attr(a.el,"x-wade-uicomponent","navbar"),a._init(),a.constructor.call(a))};s.prototype=t.extend(new t.UIComponent,{getDisabled:function(){var t=this;return t.disabled},setDisabled:function(e){var n=this;n.disabled=!!e;var i=n.div.className?n.div.className:"";n.disabled?(" "+i+" ").indexOf(" e_dis ")<0&&(n.div.className=t.trim(i+" e_dis")):(i=t.trim((" "+i+" ").replace(/ e_dis /gi," ")),n.div.className=i)},destroy:function(){var t=this;t.div=null,t.btnMore=null,t.btnFirst=null,t.btnPrev=null,t.btnNext=null,t.btnLast=null,t.option=null,t.gotoIpt=null,t.gotoBtn=null,t.pageSizeSel=null},_init:function(){var e=this;e.div=t(e.el).parent("div.c_page:first")[0],e.btnMore=t(e.div).children("div.more:first")[0];var i=t(e.div).children("div.turn:first");e.btnFirst=i.children("div.first:first")[0],e.btnPrev=i.children("div.prev:first")[0],e.btnNext=i.children("div.next:first")[0],e.btnLast=i.children("div.last:first")[0],e.btnStat=i.children("div.stat:first")[0],i=null,e.option=t(e.div).children("div.option:first")[0],e.gotoIpt=t(e.option).children("div.goto:first").children("input[type=text]:first")[0],e.gotoBtn=t(e.option).children("div.goto:first").children("button:first")[0],e.pageSizeSel=n.getElementById(e.id+"_pagesize_sel"),e.option&&t.attr(e.option,"id",e.id+"_option"),t.attr(e.btnMore,"x-navbar-id",e.id),e.disabled&&e.setDisabled(!0),e.part&&e.componentId&&(","+e.part+",").indexOf(","+e.componentId+",")<0&&(e.part+=","+e.componentId),t(e.btnMore).tap(function(){e.disabled||e._hasTableData()&&e._showOption()}),t(e.gotoIpt).bind("keydown",function(t){return!e.disabled&&(t.keyCode>47&&t.keyCode<58||t.keyCode>95&&t.keyCode<106||8==t.keyCode||46==t.keyCode)}),t(e.gotoBtn).tap(function(){if(!e.disabled){var n=e.gotoIpt.value;if(n!=e.currPage)return!n||n<1||e.pageCount>0&&n>e.pageCount?void(e.gotoIpt.value=e.currPage):void(e._hasTableData()&&(e._hideOption(),t(e.div).attr("rowcount",e.rowCount),e._toPage(n)))}}),t(e.pageSizeSel).change(function(){return!e.disabled&&(e.pageSize!=this.value&&(!!e._hasTableData()&&(e._hideOption(),!(!e.currPage||e.pageCount>0&&e.currPage>e.pageCount)&&(t(e.div).attr("rowcount",e.rowCount),!1!==e._toPage(1,this.value)&&(e.pageSize=this.value,!0)))))}),t(e.btnFirst).tap(function(){e.disabled||e.currPage<=1||(t(e.div).attr("rowcount",e.rowCount),e._toPage(1))}),t(e.btnPrev).tap(function(){e.disabled||e.currPage<=1||(t(e.div).attr("rowcount",e.rowCount),e._toPage(e.currPage-1))}),t(e.btnNext).tap(function(){e.disabled||e.pageCount>0&&e.currPage>=e.pageCount||e._hasTableData(e.pageSize)&&(t(e.div).attr("rowcount",e.rowCount),e._toPage(e.currPage+1))}),t(e.btnLast).tap(function(){e.disabled||e.pageCount>0&&e.currPage>=e.pageCount||e._hasTableData()&&(t(e.div).attr("rowcount",e.rowCount),e._toPage(e.pageCount))}),t(e.btnStat).tap(function(){e.disabled||e._hasTableData()&&(t(e.div).attr("needcount","true"),e._toPage(1))})},_showOption:function(){var t=this;t.option.style.display="",d!=t.id&&(d=t.id)},_hideOption:function(){var t=this;t.option.style.display="none",d==t.id&&(d=null)},_toPage:function(e,n){var i=this;if(!1===i._triggerBeforeAction())return!1;var a=i.part;if(a&&t.isString(a)){for(var r,o,d=a.split(","),l=!1,s=0;s<d.length&&(!(o=d[s])||(r=t("#"+o+" input[id="+i.id+"]"),!r.length||(r.each(function(){if("navbar"==t.attr(this,"x-wade-uicomponent"))return l=!0,!1}),!0!==l)));s++);if(!1===l)return void MessageBox.error(t.lang.get("ui.component.navbar.tip.msg-title"),t.lang.get("ui.component.navbar.tip.part-not-contain",a,i.id))}t.beginPageLoading(i.loadingTxt),t.ajax.submit(i.cond,i.listener?i.listener:"",i._buildParams(e,n),i.part,function(){t.endPageLoading()},function(e,n){t.endPageLoading(),MessageBox.error(t.lang.get("ui.component.navbar.tip.turn-page-error"),t.lang.get("ui.component.navbar.tip.error-info",e,n))},{navbarPageTurn:!0})},_buildParams:function(e,n){var i=this,a=i.id,r=void 0==e?i.currPage:e,o=void 0==n?i.pageSize:n,d=t(i.div).attr("needcount"),l="true"==d?"true":"false",s=t(i.div).attr("rowcount");return void 0==s&&(s=0),"&pagin="+a+"&"+a+"_count="+s+"&"+a+"_current="+r+"&"+a+"_pagesize="+o+"&"+a+"_needcount="+l},_hasTableData:function(e){var n=this,i=n.part;if(i&&t.isString(i)){var a=i.split(",")[0];if(a){var r=t("#"+a+" div[class*=c_table]").find("table:first");if(r.length>0){var o=r[0].tBodies[0];if(o){if(e&&o.rows.length<e)return!1;if(o.rows.length<=0)return!1}}}}return!0},_registerAction:function(){var e=this,n=t._data?t._data(e.el,"events"):t.data(e.el,"events");if(n){var a=n.beforeAction;if(a&&a.length>0){var r,o=l[e.id+"_beforeAction"];o||(o=l[e.id+"_beforeAction"]=[]),a=a.slice(0);for(var d=0,s=a.length;d<s;d++)r=a[d],t.inArray(r.handler,o)<0&&i.call(o,r.handler)}var a=n.afterAction;if(a&&a.length>0){var r,o=l[e.id+"_afterAction"];o||(o=l[e.id+"_afterAction"]=[]),a=a.slice(0);for(var d=0,s=a.length;d<s;d++)r=a[d],t.inArray(r.handler,o)<0&&i.call(o,r.handler)}}},_restoreAction:function(){var e=this,n=l[e.id+"_beforeAction"];if(n&&n.length){for(var i=0;i<n.length;i++)t.event.add(e.el,"beforeAction",n[i]),a.call(n,i--,1);delete l[e.id+"_beforeAction"]}if(n=l[e.id+"_afterAction"],n&&n.length){for(var i=0;i<n.length;i++)t.event.add(e.el,"afterAction",n[i]),a.call(n,i--,1);delete l[e.id+"afterAction"]}n=null},_triggerBeforeAction:function(){return t.event.trigger("beforeAction",null,this.el)},_triggerAfterAction:function(e){return t.event.trigger("afterAction",e,this.el)}});var u=function(e){var n,i,a;if(e&&t.isString(e)){var r=e.lastIndexOf("\n");r>-1&&(i=e.substring(r+1,e.length)),i=t.parseJSON(t.parseJsonString(i)),n=i.context.x_resultcode,i=i.data}if("0"==n&&i&&(t.isArray(i)||t.isObject(i)))if(t.isArray(i)){var o=!0;if(i.length){var d=i.length;d&&/^\d+$/.test(d)&&parseInt(d)>0||(o=!1)}else o=!1;a=o?new t.DatasetList(i):new t.DatasetList}else a=new t.DataMap(i);return a},c=function(t){if(t){var n=e[t];n&&n instanceof s&&n._hideOption()}},f=function(e){if(e&&t.isString(e)){var n="&partids=",i=e.indexOf(n);if(!(i<0)){var a=e.substring(i+n.length);if(a)return i=a.indexOf("&"),i>0&&(a=a.substring(0,i)),a}}};t(n).ajaxSend(function(n,i,a){if(a&&a.url&&t.isString(a.url)){var r=f(a.url);if(r){for(var o,d,l,u,c=[],g=r.split(","),v=0;v<g.length;v++)(o=g[v])&&(u=t("#"+o+" input[x-wade-uicomponent=navbar]"),u.length&&u.each(function(){l=t.attr(this,"id"),l&&(d=e[l])&&d instanceof s&&(!0!==a.navbarPageTurn&&c.push(d._buildParams(1)),d._registerAction())}));l=u=null,r=g=o=null,!0!==a.navbarPageTurn&&c.length&&(a.data=(a.data?a.data:"")+c.join("")),c=null}}}),t(n).ajaxSuccess(function(n,i,a){if(a&&a.url&&t.isString(a.url)){var r=f(a.url);if(r){for(var o,d,l,c,g=u(i.responseText),v=r.split(","),p=0;p<v.length;p++)(o=v[p])&&(c=t("#"+o+" input[x-wade-uicomponent=navbar]"),c.length&&c.each(function(){l=t.attr(this,"id"),l&&(d=e[l])&&d instanceof s&&(d._restoreAction(),!0===a.navbarPageTurn&&d._triggerAfterAction(g))}));l=c=null,r=v=o=null}}}),t(function(){t(n.body).bind(o,function(e){if(e&&e.target){var i=e.target;if(i&&i.nodeType){for(var a,r,o=0,l=i,s=!1;o<50&&l!=n.body;){if(l&&1==l.nodeType){if("more"==t.attr(l,"className")&&(a=t.attr(l,"x-navbar-id"))){s=!0;break}if("option"==t.attr(l,"className")&&d&&(r=t.attr(l,"id"))&&0==r.indexOf(d)){s=!0;break}if(d&&(r=t.attr(l,"id"))&&0==r.indexOf(d)&&r.indexOf("_sel_float")>-1){s=!0;break}}l=l.parentNode,o++}!s&&d&&c(d)}}})}),e.NavBar=t.NavBar=s}}(window.Wade,window,document);