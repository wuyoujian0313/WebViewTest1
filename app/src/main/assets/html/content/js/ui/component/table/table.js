/*!
 * table component
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(e,t,l){"use strict";if(e&&"undefined"==typeof e.Table){var i=Array.prototype.push,o=(Array.prototype.splice,e.os.phone||!0===e.ratioPhone),a=/^[0-9]+$/,d=/<\/?.+?>/g,n={add:"0",upd:"2",del:"1"},s="_nocol",r=[],f=function(t,i){var o=this;o.el=t&&1==t.nodeType?t:l.getElementById(t),o.el&&o.el.nodeType&&(o.id=e.attr(o.el,"id"))&&(i&&e.isObject(i)&&e.extend(o,i),e.attr(o.el,"x-wade-uicomponent")||e.attr(o.el,"x-wade-uicomponent","table"),o._init(),o.constructor.call(o))};f.prototype=e.extend(new e.UIComponent,{getData:function(t,l){var i=this;if(!i.head||!i.bodyTableBody)return null;t&&e.isString(t)&&(l=t,t=!1),l&&e.isString(l)&&(l=","+l+",");var o,a,d,n,r=new e.DatasetList;return e.each(i.bodyTableBody.rows,function(f,h){if(n=e.attr(h,"status"),(void 0==n||null==n)&&(n="",!0!==t))return!0;var u=new e.DataMap;for(o in i.head)0!=o.indexOf(s)&&(d=i.head[o][0],void 0!=d&&(!l||l.indexOf(","+o+",")>-1)&&(a=h.cells[d],u.put(o,p(a))));u.put("tag",n),r.add(u)}),o=a=d=null,r},getRowData:function(t,l){var i=this;if(!a.test(t))return null;if(!i.head||!i.bodyTableBody)return null;l&&e.isString(l)&&(l=","+l+",");var o=i.bodyTableBody.rows[t];if(!o||!o.nodeType)return null;var d,n,r,f=new e.DataMap,h=e.attr(o,"status");void 0!=h&&null!=h||(h="");for(d in i.head)0!=d.indexOf(s)&&(r=i.head[d][0],void 0!=r&&(!l||l.indexOf(","+d+",")>-1)&&(n=o.cells[r],f.put(d,p(n))));return f.put("tag",h),d=n=r=null,o=null,f},getSelectedRowData:function(e){var t=this;return t.getRowData(t.selected,e)},getCheckedRowsData:function(t,l){var i=this;if(!t||!e.isString(t))return null;if(!i.head||!i.bodyTableBody)return null;l&&e.isString(l)&&(l=","+l+",");var o=e("input[name="+t+"]:checked",i.bodyTableBody);if(!o.length)return null;var a,d,n,r,f,h=new e.DatasetList;return o.each(function(){if(d=u(this)){var t=new e.DataMap;f=e.attr(d,"status"),void 0!=f&&null!=f||(f="");for(a in i.head)0!=a.indexOf(s)&&(r=i.head[a][0],void 0!=r&&(!l||l.indexOf(","+a+",")>-1)&&(n=d.cells[r],t.put(a,p(n))));t.put("tag",f),h.add(t)}}),a=n=r=d=o=null,h},addRow:function(t,l){var i=this;if(e.isObject(t)&&!e.isEmptyObject(t)&&i.head&&i.bodyTableBody){var o,d=t._className?t._className:"new",r=[];r.push('<tr status="'+n.add+'" '),d&&e.isString(d)&&r.push(' class="'+d+'" '),r.push(" >");for(var f in i.head)d=i.head[f][1],o=i.head[f][2],r.push("<td"+(d?' class="'+d+'" ':"")+(!1===o?' style="display:none;" ':"")+">"),0!=(""+f).indexOf(s)&&r.push(t.hasOwnProperty(f)?t[f]:""),r.push("</td>");r.push("</tr>"),!0===l?(a.test(i.selected)&&i.selected++,e(i.bodyTableBody).prepend(r.join(""))):e(i.bodyTableBody).append(r.join("")),r=null,setTimeout("window['"+i.id+"'].adjust(true, false);",1)}},deleteRow:function(t,l){var i=this;if(t&&1==t.nodeType)return void i.deleteRow(e.inArray(u(t),i.bodyTableBody.rows));if(a.test(t)&&!(t<0)&&i.bodyTableHead&&i.bodyTableBody){var o=i.bodyTableBody.rows[t];if(!o||!o.nodeType)return;var d,s=e.attr(o,"status");void 0==s||n.upd==s?(e.attr(o,"status",n.del),d=o.className?o.className:"",(" "+d+" ").indexOf(" deleted ")<0&&(o.className=e.trim(d+" deleted")),!0!==l?o.style.display="none":e(o).remove()):n.add==s&&e(o).remove(),i.selected==t&&(i.selected=null),s=d=null,o=null,setTimeout("window['"+i.id+"'].adjust(true, false);",1)}},updateRow:function(t,l){var i=this;if(a.test(l)&&e.isObject(t)&&!e.isEmptyObject(t)&&i.head&&i.bodyTableBody){var o=i.bodyTableBody.rows[l];if(o&&o.nodeType){var d,r,f,h=e.attr(o,"status");for(d in i.head)0!=d.indexOf(s)&&(f=i.head[d][0],r=o.cells[f],r&&r.nodeType&&t.hasOwnProperty(d)&&(r.innerHTML=t[d]));n.add!=h&&e.attr(o,"status",n.upd),d=r=f=null,o=null,setTimeout("window['"+i.id+"'].adjust(true, false);",1)}}},primaryDataExist:function(t,l,i,o){var d=this;if(!t||!e.isString(t))return!1;if(!l||!e.isPlainObject(l))return!1;var n=t.split(","),s="";if(e.each(n,function(e,t){s+=l[t]}),!a.test(i)){if(!d.bodyTableBody)return!1;var r,f,h=!1;return e.each(d.bodyTableBody.rows,function(l,i){if(void 0==o||!(e.isNumber(o)&&o==l||e.isArray(o)&&e.inArray(l,o)>-1))return f="",r=d.getRowData(l,t),r&&(e.each(n,function(t,l){f+=e.isPlainObject(r)?r[l]:r.get(l)}),f==s)?(h=!0,!1):void 0}),h}var r=d.getRowData(i,t);if(r){var f="";return e.each(n,function(t,l){f+=e.isPlainObject(r)?r[l]:r.get(l)}),s==f}return!1},adjust:function(e,t){var l=this;o&&!l.padMode||(l.fixedTop("undefined"==typeof e||e),(l.fixedLeftCols||l.fixedRightCols)&&l.fixedColumns("undefined"==typeof t||t)),l.scroller&&l.scroller.refresh()},fixedTop:function(t){var l=this;if(!1!==l.fixedMode&&(!o||l.padMode)&&l.bodyTableHead){!0!==t&&(l.topTableHead.style.display="none",e(l.topTableHead).html(l.bodyTableHead.innerHTML),l.topTableHead.style.display="");var i;e("tr",l.bodyTableHead).each(function(t){i=l.topTableHead.rows[t],e("th",this).each(function(e){i&&i.nodeType&&(i.cells[e].style.width=this.offsetWidth+"px",i.cells[e].style.height=this.offsetHeight+"px")})}),i=null}},fixedColumns:function(t){var l=this;if(!1!==l.fixedMode&&(!o||l.padMode)){var i=0+(l.fixedLeftCols?l.fixedLeftCols:0)+(l.fixedRightCols?l.fixedRightCols:0);if(l.bodyTableBody&&l.bodyTableBody.rows){var a=l.bodyTableBody.rows.length;if(!(a<=0)){var d=l.bodyTableBody.rows[0].cells.length;if(!(d<=0||d<i)){var n,s,r=document.createElement("div");r.style.display="none";var f,h=0,u=0,c=0,p=0,y=0;if(!0!==t){var b=[],T=[];for(h=0,c=l.bodyTableHead.rows.length;h<c;h++){if(n=l.bodyTableHead.rows[h],l.fixedLeftCols){for(b.push("<tr>"),u=0;u<l.fixedLeftCols;u++)s=n.cells[u],s&&(p=s.offsetWidth+"px",y=s.offsetHeight+"px",s=s.cloneNode(!0),s.style.width=p,s.style.height=y,r.appendChild(s),b.push(r.innerHTML),r.removeChild(s));b.push("</tr>")}if(l.fixedRightCols){for(T.push("</tr>"),u=0;u<l.fixedRightCols;u++)f=d-u-1,s=n.cells[f],s&&(p=s.offsetWidth+"px",y=s.offsetHeight+"px",s=s.cloneNode(!0),s.style.width=p,s.style.height=y,r.appendChild(s),T.splice(0,0,r.innerHTML),r.removeChild(s));T.splice(0,0,"<tr>")}}for(l.fixedLeftCols&&(e(l.leftTableHead).html(b.join("")),e(l.leftTopTableHead).html(b.join(""))),l.fixedRightCols&&(e(l.rightTableHead).html(T.join("")),e(l.rightTopTableHead).html(T.join(""))),b=[],T=[],h=0,c=l.bodyTableBody.rows.length;h<c;h++){if(n=l.bodyTableBody.rows[h],l.fixedLeftCols){for(b.push("<tr>"),u=0;u<l.fixedLeftCols;u++)s=n.cells[u],s&&(p=s.offsetWidth,y=s.offsetHeight,s=s.cloneNode(!0),s.style.width=p+"px",s.style.height=y+"px",r.appendChild(s),b.push(r.innerHTML),r.removeChild(s));b.push("</tr>")}if(l.fixedRightCols){for(T.push("</tr>"),u=0;u<l.fixedRightCols;u++)f=d-u-1,s=n.cells[f],s&&(p=s.offsetWidth+"px",y=s.offsetHeight+"px",s=s.cloneNode(!0),s.style.width=p,s.style.height=y,r.appendChild(s),T.splice(0,0,r.innerHTML),r.removeChild(s));T.splice(0,0,"<tr>")}}l.fixedLeftCols&&(e(l.leftTableBody).html(b.join("")),l.left.style.display="",l.leftTop.style.display=""),l.fixedRightCols&&(e(l.rightTableBody).html(T.join("")),l.right.style.display="",l.rightTop.style.display=""),b=T=null}else{var g,x;for(h=0,c=l.bodyTableHead.rows.length;h<c;h++){if(n=l.bodyTableHead.rows[h],l.fixedLeftCols)for(u=0;u<l.fixedLeftCols;u++)s=n.cells[u],s&&(p=s.offsetWidth+"px",y=s.offsetHeight+"px",(g=l.leftTableHead.rows[h])&&(x=g.cells[u])&&(x.style.width=p,x.style.height=y),(g=l.leftTopTableHead.rows[h])&&(x=g.cells[u])&&(x.style.width=p,x.style.height=y));if(l.fixedRightCols)for(u=0;u<l.fixedRightCols;u++)f=d-u-1,s=n.cells[f],s&&(f=l.fixedRightCols-u-1,p=s.offsetWidth+"px",y=s.offsetHeight+"px",(g=l.rightTableHead.rows[h])&&(x=g.cells[f])&&(x.style.width=p,x.style.height=y),(g=l.rightTopTableHead.rows[h])&&(x=g.cells[f])&&(x.style.width=p,x.style.height=y))}for(h=0,c=l.bodyTableBody.rows.length;h<c;h++){if(n=l.bodyTableBody.rows[h],l.fixedLeftCols)for(u=0;u<l.fixedLeftCols;u++)s=n.cells[u],s&&(p=s.offsetWidth+"px",y=s.offsetHeight+"px",(g=l.leftTableBody.rows[h])&&(x=g.cells[f])&&(x.style.width=p,x.style.height=y));if(l.fixedRightCols)for(u=0;u<l.fixedRightCols;u++)f=d-u-1,s=n.cells[f],s&&(f=l.fixedRightCols-u-1,p=s.offsetWidth+"px",y=s.offsetHeight+"px",(g=l.rightTableBody.rows[h])&&(x=g.cells[u])&&(x.style.width=p,x.style.height=y))}g=null,x=null}s=null,r=null}}}}},fillDataTitle:function(){var t=this;if(o&&!t.padMode){var l,i=t.bodyTableHead.rows[0];i&&i.nodeType&&(e("tr",t.bodyTableBody).each(function(t){e("td",this).each(function(t){l=i.cells[t],l&&l.nodeType&&(e.attr(this,"data-title",e.trim(e.text(l))),(" "+l.className+" ").indexOf(" key ")>-1&&(this.className=e.trim((this.className?this.className:"")+" key")))})}),l=i=null)}},destroy:function(){var e=this;if(e.tdClip&&(e.tdClip.destroy(),e.tdClip=null),e.rowClip&&(e.rowClip.destroy(),e.rowClip=null),e.cellClip&&(e.cellClip.destroy(),e.cellClip=null),e.head){for(var t in e.head)delete e.head[t];e.head=null}e.scroller&&e.scroller.destroy(),e.bodyTableHead=null,e.bodyTableBody=null,e.bodyTable=null,e.wrapper=null,e.body=null,e.topTableHead=null,e.topTable=null,e.top=null,e.leftTableHead=null,e.leftTableBody=null,e.leftTable=null,e.left=null,e.rightTableHead=null,e.rightTableBody=null,e.rightTable=null,e.right=null,e.leftTopTableHead=null,e.leftTopTable=null,e.leftTop=null,e.rightTopTableHead=null,e.rightTopTable=null,e.rightTop=null,e.el=null},_init:function(){var l=this;l.body=e(l.el).children("div.body:first")[0],l.wrapper=e(l.body).children("div.wrapper:first")[0],l.bodyTable=e(l.wrapper).children("table:first")[0],l.bodyTableHead=l.bodyTable.tHead,l.bodyTableBody=l.bodyTable.tBodies&&l.bodyTable.tBodies.length>0?l.bodyTable.tBodies[0]:null,l.top=e(l.el).children("div.top:first")[0],l.topTable=e(l.top).children("table:first")[0],l.topTableHead=l.topTable.tHead,l.left=e(l.el).children("div.left:first")[0],l.leftTable=e(l.left).children("table:first")[0],l.leftTableHead=l.leftTable.tHead,l.leftTableBody=l.leftTable.tBodies&&l.leftTable.tBodies.length>0?l.leftTable.tBodies[0]:null,l.right=e(l.el).children("div.right:first")[0],l.rightTable=e(l.right).children("table:first")[0],l.rightTableHead=l.rightTable.tHead,l.rightTableBody=l.rightTable.tBodies&&l.rightTable.tBodies.length>0?l.rightTable.tBodies[0]:null,l.leftTop=e(l.el).children("div.leftTop:first")[0],l.leftTopTable=e(l.leftTop).children("table:first")[0],l.leftTopTableHead=l.leftTopTable.tHead,l.rightTop=e(l.el).children("div.rightTop:first")[0],l.rightTopTable=e(l.rightTop).children("table:first")[0],l.rightTopTableHead=l.rightTopTable.tHead;var d=l.el.className;l.padMode=e.os.pad||o&&(" "+d+" ").indexOf(" c_table-hasGrid ")>-1,l.bodyTableHead&&(l.head=c(l.bodyTableHead,!0)),l.useScroller&&(o||l.padMode)?l.scroller||(l.scroller=new e.Scroll(l.body,{bounce:"undefined"!=typeof l.bounce&&l.bounce,momentum:"undefined"==typeof l.momentum||l.momentum,checkDOMChanges:"undefined"!=typeof l.checkDOMChanges&&l.checkDOMChanges,onPosition:function(e,t,i,o){this.options.useTransform?(l.top.style[i]="translate("+e+"px,0px) scale("+this.scale+")"+o,l.fixedLeftCols&&(l.left.style[i]="translate(0px,"+t+"px) scale("+this.scale+")"+o),l.fixedRightCols&&(l.right.style[i]="translate(0px,"+t+"px) scale("+this.scale+")"+o)):(e=m.round(e),l.top.style.left=e+"px")}})):e(l.body).bind("scroll",function(){var e=l.body.scrollLeft;"undefined"!=typeof e&&(l.top.style.left=0-e+"px");var t=l.body.scrollTop;"undefined"!=typeof t&&(l.fixedLeftCols&&(l.left.style.top=0-t+"px"),l.fixedRightCols&&(l.right.style.top=0-t+"px"))}),e.inArray(l.id,r)<0&&i.call(r,l.id),e(function(){l.adjust(!1,!1),l.body.scrollWidth&&l.body.scrollWidth>l.body.offsetWidth&&e(l.el).append('<div class="cover"></div>')}),l.bodyTableBody&&!1!==l.editMode&&e(l.el).tap(function(t){if(t.originalEvent&&(t=e.event.fix(t.originalEvent)),t.target){var i=h(t.target);if(i){var o,d=i.parentNode;if(a.test(l.selected)){var n=l.bodyTableBody.rows[l.selected];n&&n.nodeType&&(o=n.className?n.className:"",(" "+o+" ").indexOf(" on ")>-1&&(n.className=e.trim((" "+o+" ").replace(/ on /g," ")))),l.fixedLeftCols&&(n=l.leftTableBody.rows[l.selected],n&&n.nodeType&&(o=n.className?n.className:"",(" "+o+" ").indexOf(" on ")>-1&&(n.className=e.trim((" "+o+" ").replace(/ on /g," "))))),l.fixedRightCols&&(n=l.rightTableBody.rows[l.selected],n&&n.nodeType&&(o=n.className?n.className:"",(" "+o+" ").indexOf(" on ")>-1&&(n.className=e.trim((" "+o+" ").replace(/ on /g," "))))),n=null}d.parentNode==l.bodyTableBody?l.selected=e.inArray(d,l.bodyTableBody.rows):l.fixedLeftCols&&d.parentNode==l.leftTableBody?l.selected=e.inArray(d,l.leftTableBody.rows):l.fixedRightCols&&(l.selected=e.inArray(d,l.rightTableBody.rows)),a.test(l.selected)&&((d=l.bodyTableBody.rows[l.selected])&&(o=d.className?d.className:"",(" "+o+" ").indexOf(" on ")<0&&(d.className=e.trim(o+" on"))),l.fixedLeftCols&&(d=l.leftTableBody.rows[l.selected])&&(o=d.className?d.className:"",(" "+o+" ").indexOf(" on ")<0&&(d.className=e.trim(o+" on"))),l.fixedRightCols&&(d=l.rightTableBody.rows[l.selected])&&(o=d.className?d.className:"",(" "+o+" ").indexOf(" on ")<0&&(d.className=e.trim(o+" on")))),o=null,i=d=null}}}),e(l.body).bind("scroll",function(t){if(l.body.scrollWidth){var i=e(l.el).children("div .cover:first");l.body.scrollLeft+l.body.offsetWidth>=l.body.scrollWidth-3?i.css("display","none"):i.css("display","")}}),(o||l.padMode)&&e(l.el).bind("selectstart",function(e){return e.stop(),!1}),e(t).bind("onorientationchange"in t?"orientationchange":"resize",l.id,function(l){var i=l?l.data:null;i&&e.isString(i)&&t[i]&&t[i].adjust()})}});var h=function(t){if(!t||!t.nodeType)return null;for(var l=0,i=t;l<5&&i&&i.nodeType;){if(1==i.nodeType&&e.nodeName(i,"td"))return i;i=i.parentNode,l++}},u=function(t){if(t&&t.nodeType)for(var l=0,i=t;l<5&&i&&i.nodeType;){if(1==i.nodeType&&e.nodeName(i,"tr"))return i;i=i.parentNode,l++}},c=function(t,l){if(!t||!t.nodeType||!e.nodeName(t,"thead"))return null;var i=t.getElementsByTagName("tr")[0];if(!i||!i.nodeType)return null;var o,a,d,n,r,f={},h=i.getElementsByTagName("th");if(h&&h.length>0)for(o=0;o<h.length;)a=h[o],d=e.attr(a,"col"),n=a.className?a.className:"",r="none"!=a.style.display,(d||!0===l&&(d=s+"_"+o))&&(f[d]=[o,n,r]),o++;return a=i=h=n=null,f},p=function(t){return t&&t.nodeType?e.browser.msie?e.trim(t.innerText):e.trim((""+t.innerHTML).replace(d,"")):null},y=function(t){if(t&&e.isString(t)){var l="&partids=",i=t.indexOf(l);if(!(i<0)){var o=t.substring(i+l.length);if(o)return i=o.indexOf("&"),i>0&&(o=o.substring(0,i)),o}}};e.extend(f,{adjust:function(e,l){if(r.length>0)for(var i,o=0,a=r.length;o<a;o++)i=r[o],t[i]&&t[i].adjust(e,l)}}),e.extend({getTableData:function(l){var i=l&&e.isString(l)?t[l]:null;if(i)return i.getData()},getTableRowData:function(l,i){var o=l&&e.isString(l)?t[l]:null;if(o)return o.getRowData(i)},addTableRow:function(l,i){var o=l&&e.isString(l)?t[l]:null;if(o)return o.addRow(i)},deleteTableRow:function(l,i){var o=l&&e.isString(l)?t[l]:null;if(o)return o.deleteRow(i)},updateTableRow:function(l,i){var o=l&&e.isString(l)?t[l]:null;if(o)return o.updateRow(i)}}),e.each("getTableData,getTableRowData,addTableRow,deleteTableRow,updateTableRow".split(","),function(l,i){t[i]=e[i]}),e(l).ajaxSuccess(function(l,i,a){if(a&&a.url&&e.isString(a.url)){var d=y(a.url);if(d){for(var n,s,r,h,u=d.split(","),c=0;c<u.length;c++)(n=u[c])&&(h=e("#"+n+" div[x-wade-uicomponent=table]"),h.length&&h.each(function(){r=e.attr(this,"id"),r&&(s=t[r])&&s instanceof f&&(s.adjust(!1,!1),o&&!s.padMode&&s.fillDataTitle())}));r=h=null,d=u=n=null}}}),t.Table=e.Table=f}}(window.Wade,window,document);