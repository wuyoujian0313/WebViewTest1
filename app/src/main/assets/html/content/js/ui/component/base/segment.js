/*!
 * segment component
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(e,n,t){"use strict";function i(i,s,l,d){if(i&&e.isString(i)&&(i=t.getElementById(i)),i&&i.nodeType){var r=e.extend({},l);if(r.name&&e.isString(r.name)){if(r.id&&e.isString(r.id)||(r.id=r.name),n[r.id]&&n[r.id]instanceof a)return void MessageBox.error('Segment component "'+r.id+'" is exist!');var u=r.className&&e.isString(r.className)?r.className:"e_segment",c=r.style&&e.isString(r.style)?r.style:"",p=r.textField&&e.isString(r.textField)?r.textField:"TEXT",o=r.valueField&&e.isString(r.valueField)?r.valueField:"VALUE",v=r.titleField&&e.isString(r.titleField)?r.titleField:"TITLE",f="",g=-1;!0===r.disabled&&(u+=" e_dis");var m=[];if(m.push('\r\n<span class="'+u+'"'+(c?' style="'+c+'" ':"")+'">'),d&&d.length){var x=d instanceof Array,h=d instanceof e.DatasetList;if(x||h){var b,y,I,N,S=!1,F=0;e.each(d,function(n){if(b=h?d.get(n):d[n]){if(y=h?b.get(p):b[p],I=h?b.get(o):b[o],N=h?b.get(v):b[v],N||(N=y),S=g<0&&void 0!=typeof r.value&&null!=r.value&&""!=r.value&&r.value==I,S&&(f=I,g=F),m.push("\r\n<span "+(S?'class="e_segmentOn"':"")+' idx="'+F+'" val="'+I+'"'),r.attributeField&&e.isString(r.attributeField)){var t;e.each(r.attributeField.split(","),function(n,i){t=h?b.get(i):b[i],void 0!=typeof t&&m.push(" "+attr+'="'+e.xss(t)+'" ')})}m.push(">"),m.push("\r\n"+y),m.push("\r\n</span>"),F++}})}}return m.push('\r\n<input type="hidden" x-wade-uicomponent="segment"  name="'+r.name+'" id="'+r.id+'" value="'+f+'" '+(r.desc&&e.isString(r.desc)?' desc="'+r.desc+'" ':"")+(r.nullable&&e.isString(r.nullable)?' nullable="'+r.nullable+'" ':"")+" />"),m.push("\r\n</span>"),e(i)[s](m.join("")),m=null,n[r.id]=new Wade.Segment(r.id,{disabled:!0===r.disabled,selectedIndex:g}),n[r.id]}}}if(e&&"undefined"==typeof e.Segment){var a=function(n,i){var a=this;a.el=n&&1==n.nodeType?n:t.getElementById(n),a.el&&a.el.nodeType&&(a.id=e.attr(a.el,"id"))&&(i&&e.isObject(i)&&e.extend(a,i),e.attr(a.el,"x-wade-uicomponent")||e.attr(a.el,"x-wade-uicomponent","segment"),a._init(),a.constructor.call(a))};a.prototype=e.extend(new e.UIComponent,{val:function(n){var t=this;if(void 0==n)return t.value;var i,a,s=!1;e(t.span).children("span").each(function(){if(i=e.attr(this,"val"),a=e.attr(this,"idx"),i==n&&e.isNumeric(a)&&a!=t.selectedIndex)return s=!0,a=parseInt(a),t.selectedIndex>-1&&e("span:nth-child("+(t.selectedIndex+1)+")",t.span).attr("className",""),this.className="e_segmentOn",t.selectedIndex=a,t.value=t.el.value=i,!1}),""==n&&!s&&t.selectedIndex>-1&&(e("span:nth-child("+(t.selectedIndex+1)+")",t.span).attr("className",""),t.selectedIndex=-1,t.value=t.el.value=n),i=a=null},append:function(n,t){var i=this;if((e.isNumeric(n)||e.isString(n))&&(e.isNumeric(t)||e.isString(t))){n=e.xss(n,!0),t=e.xss(t,!0);var a=i.span.getElementsByTagName("span"),s=a?a.length:0;a=null,e(i.el).before('<span idx="'+s+'" val="'+t+'">'+n+"</span>")}},getDisabled:function(){var e=this;return e.disabled},setDisabled:function(n){var t=this;t.disabled=!!n;var i=t.span.className?t.span.className:"";t.disabled?(" "+i+" ").indexOf(" e_dis ")<0&&(t.span.className=e.trim(i+" e_dis")):(i=e.trim((" "+i+" ").replace(/ e_dis /gi," ")),t.span.className=i)},destroy:function(){var e=this;e.span=null,e.el=null},_init:function(){var n=this;n.span=e(n.el).parent("span.e_segment:first")[0],"undefined"==typeof n.value&&(n.value=n.el.value);var t=e.attr(n.span,"id");t||(t=n.id+"_span",e.attr(n.span,"id",t)),e.attr(n.el,"x-visible-element",t),n.disabled&&n.setDisabled(!0),e(n.span).tap(function(t){if(!n.disabled){t.originalEvent&&(t=e.event.fix(t.originalEvent));var i,a,s=t.target;if(s&&1==s.nodeType&&e.nodeName(s,"span")){if(i=e.attr(s,"val"),a=e.attr(s,"idx"),!e.isNumeric(a))return;if(a==n.selectedIndex)return;a=parseInt(a),n.selectedIndex>-1&&e("span:nth-child("+(n.selectedIndex+1)+")",n.span).attr("className",""),s.className="e_segmentOn",n.selectedIndex=a,n.value=n.el.value=i,e.event.trigger({type:"change",originalEvent:t.originalEvent},null,n.el)}}})}}),e.extend(a,{append:function(e,n,t){return i(e,"append",n,t)},prepend:function(e,n,t){return i(e,"prepend",n,t)},before:function(e,n,t){return i(e,"before",n,t)},after:function(e,n,t){return i(e,"after",n,t)}}),n.Segment=e.Segment=a}}(window.Wade,window,document);