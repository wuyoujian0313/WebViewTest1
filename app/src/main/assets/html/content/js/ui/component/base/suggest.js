/*!
 * suggest component
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(e,t,l){"use strict";function n(e){return""===s?e:(e=e.charAt(0).toUpperCase()+e.substr(1),s+e)}if(e&&"undefined"==typeof e.Suggest){var i=(Math,l.createElement("div").style),s=function(){for(var e,t="t,webkitT,MozT,msT,OT".split(","),l=0,n=t.length;l<n;l++)if(e=t[l]+"ransform",e in i)return t[l].substr(0,t[l].length-1);return!1}(),a=s?"-"+s.toLowerCase()+"-":"",r=n("transform"),o=n("transitionProperty"),d=n("transitionDuration"),c=(n("transformOrigin"),n("transitionTimingFunction")),f=(n("transitionDelay"),n("perspective")in i),p="undefined"!=typeof e.hasTouch?e.hasTouch:"ontouchstart"in t,u=s!==!1,m=(n("transition")in i,function(){if(s===!1)return!1;var e={"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"otransitionend",ms:"MSTransitionEnd"};return e[s]}()),h=f?" translateZ(0)":"";i[r]=h;var E=l.createElement("input"),y="oninput"in E;E=null;var p="undefined"!=typeof e.hasTouch?e.hasTouch:"ontouchstart"in t,v=p?"touchstart":"mousedown",g=200,b=e.os.phone||!0===e.ratioPhone,x=null,T=function(t,n){var i=this;i.el=t&&1==t.nodeType?t:l.getElementById(t),i.el&&i.el.nodeType&&(i.id=e.attr(i.el,"id"))&&(n&&e.isObject(n)&&e.extend(i,n),e.attr(i.el,"x-wade-uicomponent")||e.attr(i.el,"x-wade-uicomponent","suggest"),i._init(),i.constructor.call(i))};T.prototype=e.extend(new e.UIComponent,{handleEvent:function(e){var t=this;switch(e.type){case m:t._transitionEnd(e)}},setParam:function(e,t){var l=this;l.params||(l.params={}),l.params[e]=t},getDisabled:function(){var e=this;return e.disabled},setDisabled:function(t){var l=this;l.disabled=!!t;var n=l.spanEl.className?l.spanEl.className:"";l.disabled?((" "+n+" ").indexOf(" e_dis ")<0&&(l.spanEl.className=e.trim(n+" e_dis")),l.el.disabled=!0):(n=e.trim((" "+n+" ").replace(/ e_dis /gi," ")),l.spanEl.className=n,l.el.disabled=!1)},show:function(){var t=this;if(!0!==t.visible){if(b){t.backBtn&&(t.backBtn.style.display="");var l=t.spanEl.className?t.spanEl.className:"";(" "+l+" ").indexOf(" e_mix-fixed ")<0&&(t.spanEl.className=e.trim(l+" e_mix-fixed")),t.helpMsgEl&&(""!=e.trim(t.query)?t.helpMsgEl.style.display="none":t.helpMsgEl.style.display="")}t.floatEl.style.display="block",t.useTransform&&setTimeout(function(){t.scrollEl.style[o]=a+"transform",t.scrollEl.style[r]="translate(0,0)"+h},1),t.visible=!0,x=t.id}},hide:function(){var t=this;if(!1!==t.visible){if(b){t.backBtn&&(t.backBtn.style.display="none");var l=t.spanEl.className?t.spanEl.className:"";t.spanEl.className=e.trim((" "+e.trim(l)+" ").replace(/ e_mix-fixed /gi," "))}t.useTransform?setTimeout(function(){t.scrollEl.style[o]=a+"transform",t.scrollEl.style[r]="translate(0,100%)"+h},1):t.floatEl.style.display="none",t.visible=!1,x==t.id&&(x=null)}},refresh:function(){var t=this;if(t.spanEl||(t.spanEl=e(t.el).parent("span.e_mix:first")[0]),t.floatEl||(t.floatEl=l.getElementById(t.id+"_float")),t.scrollEl||(t.scrollEl=e(t.floatEl).children("div.content:first")[0]),t.listEl||(t.listEl=e(t.scrollEl).find("div.c_list:first")[0]),b)t.maxHeight=e.format.rem2px(4.8);else{var n=t.spanEl.getBoundingClientRect();t.spanLeft=n.left,t.spanTop=n.top,t.spanHeight=t.spanEl.offsetHeight,t.spanWidth=t.spanEl.offsetWidth;var i=t.spanTop,s=(t.spanLeft,l.body),a=s.offsetHeight-t.spanHeight-i;e.isNumber(s.scrollTop)&&(t.spanTop+=s.scrollTop-2),e.isNumber(s.scrollLeft)&&(t.spanLeft+=s.scrollLeft),t.dir=a>=i?"down":"up",t.maxHeight="down"==t.dir?a:i}t.floatEl.className?t.floatEl.className:"";t.visible?t.listHeight=t.listEl.offsetHeight:(t.floatEl.style.left="-99999px",t.floatEl.style.top="-99999px",t.floatEl.style.display="block",t.listHeight=t.listEl.offsetHeight,t.floatEl.style.display="");var r=Math.min(t.maxHeight,t.listHeight);t.scrollEl.style.height=r+"px",b||(t.floatEl.style.left=t.spanLeft+"px",t.floatEl.style.top=("down"==t.dir?t.spanTop+t.spanHeight:t.spanTop-r)+"px",t.floatEl.style.width=t.spanWidth+"px")},destroy:function(){var t=this;t.useTransform&&t._unbind(m),t.scroller&&t.scroller.destroy(),t.floatEl&&e(t.floatEl).remove(),t.spanEl=null,t.floatEl=null,t.bgEl=null,t.scrollEl=null,t.listEl=null,t.listUlEl=null,t.backBtn=null,t.helpMsgEl=null,t.el=null},_init:function(){var n=this;if(n.query="",n.timer=null,n.dataCache={},n.spanEl=e(n.el).parent("span.e_mix:first")[0],n.backBtn=e(n.spanEl).children("button.e_ico-back:first")[0],n.floatEl=l.getElementById(n.id+"_float"),n.bgEl=e(n.floatEl).children("div.bg:first")[0],n.scrollEl=e(n.floatEl).children("div.content:first")[0],n.listEl=e(n.scrollEl).find("div.c_list:first")[0],n.listUlEl=e(n.listEl).children("ul:first")[0],n.helpMsgEl=e(n.scrollEl).find("div.c_msg:first")[0],n.selectedIndex=-1,n.ctrlIndex=-1,n.itemCount=0,e.attr(n.el,"autocomplete","off"),b){n.useTransform=u,(" "+n.listEl.className+" ").indexOf(" c_list-phone-col-1 ")<0&&(n.listEl.className=e.trim((n.listEl.className?n.listEl.className:"")+" c_list-phone-col-1"));var i=n.floatEl.className?n.floatEl.className:"";(" "+i+" ").indexOf(" c_float-phone-full ")<0&&(i+=" c_float-phone-full"),n.floatEl.className=e.trim(i),n.helpMsgEl&&(n.helpMsgEl.style.display="")}return n.disabled&&n.setDisabled(!0),n.clazz||n.method||n.listener||n.componentId?(n.useTransform&&(n.scrollEl.style[o]="none",n.scrollEl.style[d]="300ms",n.scrollEl.style[c]="ease-out",n.scrollEl.style[r]="translate(0,100%)"+h,n._bind(m)),y?e(n.el).bind("input",function(t){void 0==n.isRunning&&""!=e.trim(n.el.value)&&n.el.value==n.defaultText||n.isRunning||n.start()}):e(n.el).bind("keyup",function(e){(32==e.keyCode||8==e.keyCode||e.keyCode>64&&e.keyCode<91||e.keyCode>47&&e.keyCode<58||e.keyCode>95&&e.keyCode<106)&&(n.isRunning||n.start())}),b||e.os.pad||(e(n.el).bind("keydown",function(t){if(13==t.keyCode||108==t.keyCode){if(n.ctrlIndex>-1){var l=n.ctrlIndex!=n.selectedIndex;if(l){var i=e("li:nth-child("+(n.ctrlIndex+1)+")",n.listUlEl);if(i.length){var s=i.attr("val"),a=e.trim(i.text());n.el.value=a,e.event.trigger("change",[a,s],n.el)}}n.hide()}return!1}}),e(n.el).bind("keyup",function(t){if(37==t.keyCode||39==t.keyCode)return e(n.el).select(),!1;if(38==t.keyCode||40==t.keyCode){if(n.itemCount<=0)return;if(n.ctrlIndex<0&&(n.ctrlIndex=n.selectedIndex),38==t.keyCode){if(0==n.ctrlIndex)return!1;n.ctrlIndex<0?n.ctrlIndex=n.itemCount-1:n.ctrlIndex--}else if(40==t.keyCode){if(n.ctrlIndex==n.itemCount-1)return!1;n.ctrlIndex<0?n.ctrlIndex=0:n.ctrlIndex++}var l=e("li:nth-child("+(n.ctrlIndex+1)+")",n.listUlEl);return e("li[class*=on]",n.listUlEl).attr("className","link"),l.attr("className","link on"),n.scroller&&l.length&&n.scroller.scrollToElement(l[0]),!1}})),e(n.el).bind(v,function(t){(b||e.trim(n.query))&&n.show()}),e(n.bgEl).tap(function(){n.hide()}),e(n.listEl).tap(function(t){if(1!=n.disabled){var l=t.touch.el;t.originalEvent&&(t=e.event.fix(t.originalEvent));var i=t.target||l;if(i){var s;if(e.nodeName(i,"li")&&(" "+i.className+" ").indexOf(" link ")>-1&&(s=i),!s)for(var a=0,r=i.parentNode;a<5&&r&&r.nodeType;){if(e.nodeName(r,"li")&&(" "+r.className+" ").indexOf(" link ")>-1){s=r;break}r=r.parentNode,a++}var o,d,c,f=!1;s&&(o=e.attr(s,"idx"),d=e.attr(s,"val"),c=e.trim(e(s).text()),void 0!=o&&e.isNumeric(o)&&n.selectedIndex!=o&&(f=!0),f&&(n.el.value=c,e("li[class$=on]",n.listUlEl).attr("className","link"),e.attr(s,"className","link on"))),n.hide(),f&&e.event.trigger("change",[c,d],n.el)}}}),b&&e(n.backBtn).bind(v,function(){n.hide()}),void e(t).bind("onorientationchange"in t?"orientationchange":"resize",n.id,function(l){var n=l?l.data:null;n&&e.isString(n)&&t[n]&&t[n].refresh()})):(n.argValid=!1,void MessageBox.error(e.lang.get("ui.component.suggest.tip.msg-title"),e.lang.get("ui.component.suggest.tip.invalid-parameter",n.id)))},start:function(){var e=this;!1!==e.argValid&&(e.timer=setTimeout(function(){e.updateData(),e.isRunning=!1},g),e.isRunning=!0)},stop:function(){var e=this;t.clearTimeout(e.timer),e.isRunning=!1},updateData:function(){var t=this;t.query=t.el.value;var l=t.query;if(e.trim(l).length)"undefined"!=typeof t.dataCache[l]?(t._fillList(t.dataCache[l]),t.refresh(),t.visible?(t.helpMsgEl&&"none"!=t.helpMsgEl.style.display&&(t.helpMsgEl.style.display="none"),t.scroller&&t.scroller.refresh()):t.show()):t.requestData();else{b?t.helpMsgEl&&(t.helpMsgEl.style.display=""):t.hide();for(var n in t.dataCache)delete t.dataCache[n]}},requestData:function(){var t=this,l=function(e){this.reqTimestamp==t.latestRequestTime&&(t._fillList(e.data),t.dataCache[t.query]=e.data,t.refresh(),t.visible?(t.helpMsgEl&&"none"!=t.helpMsgEl.style.display&&(t.helpMsgEl.style.display="none"),t.scroller&&t.scroller.refresh()):t.show())},n=(new Date).getTime();t.latestRequestTime=n;var i=t._buildParams();t.clazz&&t.method?e.httphandler.post(t.clazz,t.method,i,l,null,{dataType:"json",simple:!0,reqTimestamp:n}):(t.listener||t.componentId)&&e.ajax.post(t.page?t.page:null,t.listener,i,t.componentId?t.componentId:null,l,null,{dataType:"json",simple:!0,reqTimestamp:n})},_buildParams:function(){var t=this,l=[];if(!e.isEmptyObject(t.params))for(var n in t.params)l.push(encodeURIComponent(n)+"="+encodeURIComponent(t.params[n]));return l.push("q="+encodeURIComponent(t.query)),l.join("&")},_fillList:function(t){var l=this;if(t&&e.isArray(t)){l.itemCount=t.length,e(l.listUlEl).empty();var n,i;e.each(t,function(t,s){n=s[l.textField],i=l.valueField?s[l.valueField]:null,e(l.listUlEl).append('<li idx="'+t+'" class="link" '+(i?'val="'+i+'"':"")+'><div class="main">'+n+"</div></li>")}),l.selectedIndex=-1,l.ctrlIndex=-1}},_bind:function(e,t,n){var i=this;l.addEventListener&&(t||i.floatEl).addEventListener(e,i,!!n)},_unbind:function(e,t,n){var i=this;l.removeEventListener&&(t||i.floatEl).removeEventListener(e,i,!!n)},_transitionEnd:function(t){var l=this,n=t.target;if(n&&n.nodeType){var i=n.className?n.className:"";(" "+i+" ").indexOf(" content ")>-1&&(1==l.visible?l.scroller||!b&&!e.os.pad?l.scroller&&l.scroller.refresh():l.scroller=new e.Scroll(l.scrollEl):0==l.visible&&(l.floatEl.style.display="none")),n.style[o]="none"}}}),e(function(){e(l.body).bind(v,function(n){if(n&&n.target){var i=n.target;if(i.nodeType&&x){for(var s=0,a=i,r=!1;a&&s<50&&a!=l.body;){var o=a.nodeType?e.attr(a,"id"):null;if(o&&e.isString(o)&&0==o.indexOf(x)){r=!0;break}a=a.parentNode,s++}!r&&t[x]&&(t[x].stop(),t[x].hide())}}}),p||e(l.body).bind("mousewheel",function(n){if(n&&n.target&&x){for(var i=0,s=n.target,a=!1;s!=l.body&&i<50;){if(s.nodeType&&e.attr(s,"id")==x+"_float"){a=!0;break}s=s.parentNode,i++}!a&&t[x]&&(t[x].stop(),t[x].hide())}})}),i=null,t.Suggest=e.Suggest=T}}(window.Wade,window,document);