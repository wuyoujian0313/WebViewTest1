/*!
 * MessageBox
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(e,t,n){"use strict";function o(t){var n,o;if(t&&e.isString(t)){var i=t.substring(0,t.indexOf("\n"));i=i.split("|"),i&&i.length>2&&(n=i[0],o=i[1]),i=null}return{ERROR_LEVEL:n,ERROR_ID:o}}function i(t){if(t&&t.nodeType)for(var n=0,o=t;n<5&&o&&o.nodeType;){if(1==o.nodeType&&e.nodeName(o,"button"))return o;o=o.parentNode,n++}}if(e&&"undefined"==typeof e.MessageBox){var s=Array.prototype.push,a=Array.prototype.splice,r=e.os.phone||!0===e.ratioPhone,l=1,u={ok:e.lang.get("ui.component.messagebox.buttontext.ok"),cancel:e.lang.get("ui.component.messagebox.buttontext.cancel"),ext0:e.lang.get("ui.component.messagebox.buttontext.ext0"),ext1:e.lang.get("ui.component.messagebox.buttontext.ext1"),ext2:e.lang.get("ui.component.messagebox.buttontext.ext2"),report:e.lang.get("ui.component.messagebox.buttontext.report")},d={fullMode:!0},c=[],p={};d.DialogManager={get:function(t){if(t&&e.isString(t))return p[t]},first:function(){if(c.length>0)return p[c[0]]},last:function(){if(c.length>0)return p[c[c.length-1]]},add:function(t,n){t&&e.isString(t)&&n&&(e.inArray(t,c)>-1||(s.call(c,t),p[t]=n))},remove:function(t){t&&e.isString(t)&&(a.call(c,e.inArray(t,c),1),delete p[t])}},d.Dialog=function(t){var n=this;t&&e.isObject(t)&&e.extend(n,t),n.id="wade_messagebox-"+ ++l,n._init(),n.constructor.call(n)},d.Dialog.prototype=e.extend(new e.UIComponent,{show:function(){var t=this;if(t.el&&t.el.nodeType&&(t.el.style.display=""),t.el.style.zIndex=t.zIndex?t.zIndex:e.zIndexer.get(t.id),!e.os.pad&&!r){var n=e("#"+t.id+"_btns").children("button[tag=ok]");if(n.length>0)n.focus();else{var o=e("#"+t.id+"_btns").children("button[tag=cancel]");o.length>0?o.focus():e("#"+t.id+"_btns button:first").focus(),o=null}n=null}d.DialogManager.add(t.id,t)},hide:function(){var t=this;t.el&&t.el.nodeType&&(t.el.style.display="none"),t.zIndex||e.zIndexer.remove(t.id),d.DialogManager.remove(t.id)},destroy:function(){var t=this;if(t.zIndex||e.zIndexer.remove(t.id),d.DialogManager.remove(t.id),t.buttons){for(var n in t.buttons)delete t.buttons[n];t.buttons=null}t.msg=null,t.content=null,t.detail=null,t.fn=null,t.beforeHide=null,t.el=null},_init:function(){var t=this;"undefined"==typeof t.full&&(t.full=d.fullMode),t.msg||(t.msg=""),t.content||(t.content="");var s=e.extend({},t.buttons);e.extend(t,o(t.detail)),t.report=("DEBUG"==t.ERROR_LEVEL||"LOG"==t.ERROR_LEVEL)&&t.ERROR_ID,(t.alert||t.error)&&t.report&&(t.content+="<br />"+e.lang.get("ui.component.messagebox.report.errorid-label")+"ï¼š"+t.ERROR_ID,s.report=""+u.report);var a=[];a.push('<div id="'+t.id+'" x-wade-uicomponent="messagebox" class="'+t._getClassName()+'" style="display:none;">'),a.push('<div class="wrapper">'),a.push('<div class="emote"></div>'),a.push('<div class="info">'),a.push('<div class="text">'),a.push('<div id="'+t.id+'_title" class="title">'+t.msg+"</div>"),a.push('<div id="'+t.id+'_ct" class="content">'+t.content+"</div>"),a.push("</div>"),(t.alert||t.error)&&t.detail&&(a.push('<div id="'+t.id+'_detai_div" class="detail">'),a.push('<div class="text"><div id="'+t.id+'_detail_text">'+t.detail+"</div></div>"),a.push("</div>"),t.report&&(a.push('<div id="'+t.id+'_report_cond" style="display:none">'),a.push('<input type="hidden" name="ERROR_ID" value="'+t.ERROR_ID+'" />'),a.push('<input type="hidden" name="TRACE_ID" value="" />'),a.push('<textarea name="ERROR_INFO" style="width:0px;height:0px;display:none;">'+t.detail+"</textarea>"),a.push("</div>"))),a.push('<div id="'+t.id+'_btns" class="fn">');var r,l,c;for(var p in s)if(l=u[p])if(r=s[p],r&&e.isBoolean(r)&&(r=l),"ok"==p||"cancel"==p)a.push('<button type="button" tag="'+p+'" class="e_button-'+("ok"==p?"green":"navy")+' e_button-r"><span class="e_ico-'+("ok"==p?"ok":"close")+'"></span><span>'+r+"</span></button>");else if(r&&e.isString(r)){c=r.split(",");var g=c&&c.length>2?c[2]:"e_button-blue e_button-r";a.push('<button type="button" tag="'+p+'" class="'+g+'">'),2==c.length&&(a.push('<span tag="ico" class="e_ico-'+c[1]+'"></span>'),r=c[0]),a.push('<span tag="text">'+r+"</span></button>")}r=l=c=null,(t.alert||t.error)&&t.detail&&a.push('<button tag="copydetail" type="button" class="e_button-r"><span>'+e.lang.get("ui.component.messagebox.buttontext.select-all")+"</span></button>"),a.push("</div>"),a.push("</div>"),a.push("</div>"),a.push("</div>"),e(n.body).append(a.join("")),a=null,t.el=n.getElementById(t.id),t.btnDiv=n.getElementById(t.id+"_btns"),t.btnDiv&&e(t.btnDiv).tap(function(n){n.originalEvent&&(n=e.event.fix(n.originalEvent));var o=n.target;o&&o.nodeType&&t._buttonCallback(i(o))})},_getClassName:function(){var e=this,t="c_msg c_msg-h c_msg-phone-v";return t+=e.full?" c_msg-full":" c_msg-popup",e.alert?t+=" c_msg-warn":e.confirm?t+=" c_msg-help":e.error?t+=" c_msg-error":e.success&&(t+=" c_msg-success"),t},_triggerDefaultButton:function(){var t=this,n=e("#"+t.id+"_btns button:first");n.length&&t._buttonCallback(n[0]),n=null},_buttonCallback:function(t){var n=this;if(t&&1==t.nodeType){var o=e.attr(t,"tag");if("copydetail"==o)n._copyDetail();else if("report"==o)n._reportDetail();else{var i=!0;if(n.beforeHide&&e.isFunction(n.beforeHide)&&(i=n.beforeHide(o)),!1===i)return;n.hide(),n.fn&&e.isFunction(n.fn)&&n.fn(o)}}},_copyDetail:function(){var e=this,o=n.getElementById(e.id+"_detail_text");if(o&&o.nodeType)if(n.selection){var i=n.body.createTextRange();i.moveToElementText(o),i.moveEnd("character"),i.select()}else{var s=t.getSelection(),i=n.createRange();i.selectNode(o),s.addRange(i)}},_reportDetail:function(){var t=this;e.beginLoading(e.lang.get("ui.component.messagebox.report.loading")+"..."),e.ajax.submit(t.id+"_report_cond","reportError",null,null,function(){d.success("",e.lang.get("ui.component.messagebox.report.success")),e.endLoading()},function(t,n){d.error("",e.lang.get("ui.component.messagebox.report.error")+":<br />"+t+"<br />"+n),e.endLoading()})}}),e.extend(d,{confirm:function(t,n,o,i){return this.show({msg:t,content:n,confirm:!0,fn:o,buttons:e.extend({cancel:!0,ok:!0},i)})},success:function(t,n,o,i){return this.show({msg:t,content:n,success:!0,fn:o,buttons:e.extend({ok:!0},i)})},alert:function(t,n,o,i,s){return this.show({msg:t,content:n,alert:!0,fn:o,buttons:e.extend({ok:!0},i),detail:s})},error:function(t,n,o,i,s){return this.show({msg:t,content:n,error:!0,fn:o,buttons:e.extend({cancel:!0},i),detail:s})},show:function(e){var t=new d.Dialog(e);return t.show(),t}}),e.os.pad||r||e(n).keydown(function(t){if(13==t.keyCode||108==t.keyCode){var n=t.target;if(n&&1==n.nodeType&&(e.nodeName(n,"input")||e.nodeName(n,"textarea")))return;var o=d.DialogManager.last();o&&o._triggerDefaultButton()}}),t.MessageBox=e.MessageBox=d}}(window.Wade,window,document);