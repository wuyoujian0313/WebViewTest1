/*!
 * PopupBox
 * http://www.wadecn.com/
 * auth:xiedx@asiainfo.com
 * Copyright 2015, WADE
 */
!function(e,a,t){"use strict";function i(e,a){if(e&&e.nodeType&&a)return e.currentStyle?e.currentStyle[a]:t.defaultView.getComputedStyle(e,!1)[a]}if(e&&"undefined"==typeof e.PopupBox){var p=Array.prototype.push,n=Array.prototype.splice,r="undefined"!=typeof e.hasTouch?e.hasTouch:"ontouchstart"in a,o=r?"touchstart":"mousedown",s=null,d=[],l=0,u=function(){var a,t=e.getParentIframe();return t&&parent.Wade&&parent.Wade.PopupBox&&(a=parent.Wade.PopupBox.findPopup(t)),a&&(s=t),a},c=function(i){if(i){var p=e.Popup&&e.isFunction(e.Popup)&&e.Popup.prototype._init,n=e.Dialog&&e.isFunction(e.Dialog)&&e.Dialog.prototype._init;if(e.isString(i)&&a[i]&&(p&&a[i]instanceof e.Popup||n&&a[i]instanceof e.Dialog))return a[i];if(i.nodeType)for(var r,o,s=0,d=i.parentNode;s<50&&d&&d.nodeType&&d!=t.body;){if(e.nodeName(d,"div")&&(o=" "+d.className+" ")&&(o.indexOf(" c_popup ")>-1||o.indexOf(" c_dialog ")>-1)&&(r=e.attr(d,"id"))&&a[r]&&(p&&a[r]instanceof e.Popup||n&&a[r]instanceof e.Dialog))return a[r];d=d.parentNode,s++}}},f=function(e){var a;return s=null,(a=c(e))?a:u()},g={findPopup:function(e){return f(e)},showPopup:function(e,a,t){var i=f(e);i&&i.show(a,t)},hidePopup:function(e){var a=f(e);a&&a.hide()},forwardPopup:function(t,i,p,n,r,o){var d=f(t);if(d)if(arguments.length<3)d.forward(s?s:t,i);else{var l=i;if(!(t&&t.nodeType&&l&&e.isString(l)&&p&&e.isString(p)))return;e.Frame||a.includeScript(e.UI_FRAME_JS,!0,!0);var u=d.append(s?s:t,l),c="frame_"+u;d.getFrame(c).reset(p,n,r,o,l),d.forward(s?s:t,u),u=c=null}},backPopup:function(e,a,t,i){var p=f(e);return!!p&&(p.back(s?s:e,a,t,i),!0)},popupPage:function(i,p,n,r,o,s,d,l,u){if(e.isSameDomain(parent)&&!e.isSamePage(parent)&&!0!==parent.StopPopupRecursion&&parent.Wade&&(parent.Wade.Popup||parent.Wade.Dialog||parent.Wade.Tabset)){var c,f,g=e.getParentIframe();if(g&&((c=e.attr(g,"popupId"))&&parent[c]&&(parent.Wade.Popup&&parent[c]instanceof parent.Wade.Popup||parent.Wade.Dialog&&parent[c]instanceof parent.Wade.Dialog)||(f=e.attr(g,"tabsetId"))&&parent[f]&&parent.Wade.Tabset&&parent[f]instanceof parent.Wade.Tabset))return void parent.popupPage(i,p,n,r,o,s,d,l,a)}if(i&&e.isString(i)&&p&&e.isString(p)){e.Popup||a.includeScript(e.UI_POPUP_JS,!0,!0),e.Frame||a.includeScript(e.UI_FRAME_JS,!0,!0),e.isFunction(s)&&(l=d,d=s,s=null),i=e.xss(i);var v,m=e.md5("popup_"+i);if(v=a["popup_"+m]){if(!0!==v.visible){var h=a["frame_"+m].reset(p,n,r,o,i);v.show(1,h)}}else{s?"half"==s?s="c_popup c_popup-half":"full"==s&&(s="c_popup c_popup-full"):s="c_popup";var _=[];_.push('<div id="popup_'+m+'" class="'+s+'">'),_.push('<div class="c_popupBg"></div>'),_.push('<div class="c_popupBox">'),_.push('<div class="c_popupWrapper">'),_.push('<div id="popup_'+m+'_group1" class="c_popupGroup" level="1">'),_.push('<div class="c_popupItem">'),_.push('<iframe id="frame_'+m+'" style="width:100%;height:100%;display:none" frameborder="0"></iframe>'),_.push('<div class="c_msg c_msg-full c_msg-loading">'),_.push('<div class="wrapper">'),_.push('<div class="emote"></div>'),_.push('<div class="info"><div class="text"><div class="title">loading</div></div></div>'),_.push("</div>"),_.push("</div>"),_.push("</div>"),_.push("</div>"),_.push("</div>"),_.push("</div>"),e(t.body).append(_.join("")),_=null,d&&(e.isFunction(d)?e("#popup_"+m).afterAction(d):e.isString(d)&&e("#popup_"+m).attr("onafterAction",d)),l&&(e.isFunction(l)?e("#popup_"+m).hideAction(l):e.isString(l)&&e("#popup_"+m).attr("onhideAction",l)),a["frame_"+m]=new Wade.Frame("frame_"+m,{autoInit:!1,title:i,page:p,listener:n,params:r,subsys:o}),v=a["popup_"+m]=new Wade.Popup("popup_"+m,{visible:!1,mask:!0,srcWindow:u}),v.show(1)}return v}},popupDialog:function(i,p,n,r,o,s,d,l,u,c,f){if(e.isNumeric(o)&&(c=u,u=l,l=d,d=s,s=o,o=null),e.isFunction(l)&&(u=l,c=u,l=!0),e.isSameDomain(parent)&&!e.isSamePage(parent)&&!0!==parent.StopPopupRecursion&&parent.Wade&&(parent.Wade.Popup||parent.Wade.Dialog||parent.Wade.Tabset)){var g,v,m=e.getParentIframe();if(m&&((g=e.attr(m,"popupId"))&&parent[g]&&(parent.Wade.Popup&&parent[g]instanceof parent.Wade.Popup||parent.Wade.Dialog&&parent[g]instanceof parent.Wade.Dialog)||(v=e.attr(m,"tabsetId"))&&parent[v]&&parent.Wade.Tabset&&parent[v]instanceof parent.Wade.Tabset))return void parent.popupDialog(i,p,n,r,o,s,d,l,u,c,a)}if(i&&e.isString(i)&&p&&e.isString(p)){e.Dialog||a.includeScript(e.UI_DIALOG_JS,!0,!0),e.Frame||a.includeScript(e.UI_FRAME_JS,!0,!0),i=e.xss(i);var h,_=e.md5("dialog_"+i);if(h=a["dialog_"+_]){if(!0!==h.visible){a["frame_"+_].reset(p,n,r,o,i);h.show()}}else{e.isNumeric(s)&&(s+="em"),e.isNumeric(d)&&(d+="em");var y=[];y.push('<div id="dialog_'+_+'" class="c_dialog" style="display:none;">'),y.push('<div class="wrapper">'),y.push('<div class="header">'),y.push('<div class="text">'+i+"</div>"),y.push('<div class="fn">'),y.push('<div class="close"></div>'),y.push("</div>"),y.push("</div>"),y.push('<div class="content">'),y.push('<iframe id="frame_'+_+'" style="width:100%;height:100%;display:none" frameborder="0"></iframe>'),y.push('<div class="c_msg c_msg-full c_msg-loading">'),y.push('<div class="wrapper">'),y.push('<div class="emote"></div>'),y.push('<div class="info"><div class="text"><div class="title">loading</div></div></div>'),y.push("</div>"),y.push("</div>"),y.push("</div>"),y.push("</div>"),e(t.body).append(y.join("")),y=null,u&&(e.isFunction(u)?e("#dialog_"+_).afterAction(u):e.isString(u)&&e("#dialog_"+_).attr("onafterAction",u)),c&&(e.isFunction(c)?e("#dialog_"+_).hideAction(c):e.isString(c)&&e("#dialog_"+_).attr("onhideAction",c)),a["frame_"+_]=new Wade.Frame("frame_"+_,{autoInit:!1,title:i,page:p,listener:n,params:r,subsys:o}),h=a["dialog_"+_]=new Wade.Dialog("dialog_"+_,{closeable:0!=l,height:d,width:s,srcWindow:f}),h.show()}return h}},setPopupReturnValue:function(t,i,p,n){var r,o=e.isSameDomain(parent),s=o&&parent.Wade&&parent.System,d=o&&parent.Wade&&parent.popupPageExternal;if(s||d){var l,u;if(s)r=parent;else{l=parent.Wade.getGlobalFrame().popUpExternalPageStack.slice(parent.Wade.getGlobalFrame().popUpExternalPageStack.length-1)[0];var c=parent.Wade.getFrame(l,null,"id");u=c?c.frameElement:o?a.frameElement:null;var g=u?u.srcframeName?u.srcframeName:u.getAttribute("srcframeName"):"";r=g&&""!=g?parent.Wade.getFrame(g,null,"globalUniqueFrameId"):parent.Wade.getSameWadeDomainTop()}if(!r)return;if(e.isPlainObject(p)){for(var v in p)if(v&&"undefined"!=v){var i=s?r.getElement(v):r.$("#"+v);s?i&&i.nodeType&&r.setFormElementValue(i.tagName.toLowerCase(),i,p[v]):i.val(p[v])}}else if(e.isArray(p)&&p.length&&p.length%2==0)for(var m=0;m<p.length;m+=2){var v=p[m],h=p[m+1];if(v&&"undefined"!=v){var i=s?r.getElement(v):r.$("#"+v);s?i&&i.nodeType&&r.setFormElementValue(i.tagName.toLowerCase(),i,h):i.val(h)}}if(!1!==n)if(s)parent.Wade.dialog.closeCurrentDialog();else{var _=u?u.eventId?u.eventId:u.getAttribute("eventId"):"",y=u?u.guidValue?u.guidValue:u.getAttribute("guidValue"):"";r.Wade.closePopupPageExternal(!1,null,_,y,l,!1)}}else{var P=f(t);P&&P.setPopupReturnValue(i,p,n)}},showFloatLayer:function(a,i){if(a&&e.isString(a)&&(a=t.getElementById(a)),a&&a.nodeType){var n=e.attr(a,"id");n||(n="_floatLayer_"+ ++l,e.attr(a,"id",n));var r=a.className?a.className:"";if((" "+r+" ").indexOf(" c_float ")>-1){if((" "+r+" ").indexOf(" c_float-show ")>-1)return;a.className=e.trim(r+" c_float-show")}else{var o=i&&e.isString(i)?i:"";if(a.style.display==o)return;a.style.display=o}a.style.zIndex=e.zIndexer.get(n),p.call(d,n)}},hideFloatLayer:function(a){if(a&&e.isString(a)&&(a=t.getElementById(a)),a&&a.nodeType){var i=e.attr(a,"id");if(i){var p=a.className?a.className:"";if((" "+p+" ").indexOf(" c_float ")>-1){if((" "+p+" ").indexOf(" c_float-show ")<0)return;a.className=e.trim((" "+p+" ").replace(/ c_float-show /g," "))}else{if("none"==a.style.display)return;a.style.display="none"}e.zIndexer.remove(i),n.call(d,e.inArray(i,d),1)}}},toggleFloatLayer:function(a,p){if(a&&e.isString(a)&&(a=t.getElementById(a)),a&&a.nodeType){var n=a.className?a.className:"",r=(" "+n+" ").indexOf(" c_float ")>-1?(" "+n+" ").indexOf(" c_float-show ")>-1:"none"!=i(a,"display");r?g.hideFloatLayer(a):g.showFloatLayer(a,p)}}};e(function(){e(t.body).bind(o,function(a){if(a&&a.target){var i=a.target;if(i&&i.nodeType&&!(d.length<=0)){for(var p=0,n=!1;i&&i.nodeType&&i!=t.body&&p<50;){var r=e.attr(i,"id"),o=e.attr(i,"x-wade-float");if(o&&e.inArray(o,d)==d.length-1){n=!0;break}if(r&&e.inArray(r,d)==d.length-1&&"none"!=i.style.display){n=!0;break}i=i.parentNode,p++}n||g.hideFloatLayer(d[d.length-1])}}})}),e.PopupBox=g,e.each("showPopup,hidePopup,forwardPopup,backPopup,popupPage,popupDialog,setPopupReturnValue,showFloatLayer,hideFloatLayer,toggleFloatLayer".split(","),function(t,i){a[i]=e.PopupBox[i]})}}(window.Wade,window,document);